LAMMPS (29 Oct 2020)
####################################################################################################
#
# TLSPH example:  elongate a 2d strip of a linear elastic material py pulling its ends apart
#
# unit system: GPa / mm / ms
#
####################################################################################################

####################################################################################################
# MATERIAL PARAMETERS
####################################################################################################
variable        E1 equal 1.0 # Young's modulus
variable        nu1 equal 0.35 # Poisson ratio
variable        E2 equal 3.0 # Young's modulus
variable        nu2 equal 0.3 # Poisson ratio

variable        rho equal 1 # initial mass density
variable        q1 equal 0.01 # standard artificial viscosity linear coefficient
variable        q2 equal 0.0  # standard artificial viscosity quadratic coefficient
variable        hg equal 25.0 # hourglass control coefficient
variable        cp equal 1.0 # heat capacity of material -- not used here
variable        FLAG_HYPER equal 0 # Hyperelastic flag

####################################################################################################
# INITIALIZE LAMMPS
####################################################################################################
dimension       2
units           si
boundary        sm sm p # simulation box boundaries
atom_style      smd
atom_modify     map array
comm_modify     vel yes
neigh_modify    every 10 delay 0 check yes # re-build neighbor list every 10 steps
newton          off

####################################################################################################
# CREATE INITIAL GEOMETRY
####################################################################################################
variable        l0 equal 0.04 # lattice spacing for creating particles
lattice         sq ${l0}
lattice         sq 0.04
Lattice spacing in x,y,z = 0.04 0.04 0.04

region          all block -1.00 1.001 -1 1.001 -0.01 0.01 units box
create_box      2 all
Created orthogonal box = (-1.0000000 -1.0000000 -0.01) to (1.0010000 1.0010000 0.01)
  1 by 1 by 1 MPI processor grid

## type 1
region 		down  block -1.00 1.001 -1 0.001 -0.01 0.01 units box
create_atoms    1 region down
Created 1326 atoms
  create_atoms CPU = 0.001 seconds

## type 2
region 		up    block -1.00 1.001 0.01 1.001 -0.01 0.01 units box
create_atoms    2 region up
Created 1275 atoms
  create_atoms CPU = 0.000 seconds

group 		up    region up
1275 atoms in group up
group 		down  region down
1326 atoms in group down
group           tlsph union up down
2601 atoms in group tlsph

####################################################################################################
# DISCRETIZATION PARAMETERS
####################################################################################################
variable        h equal 5.01*${l0} # SPH smoothing kernel radius
variable        h equal 5.01*0.04 
variable        vol_one equal ${l0}^2 # volume of one particle -- assuming unit thickness
variable        vol_one equal 0.04^2 
variable        skin equal ${h} # Verlet list range
variable        skin equal 0.2004 
neighbor        ${skin} bin
neighbor        0.2004 bin
set             group all volume ${vol_one}
set             group all volume 0.0016
Setting atom values ...
  2601 settings made for volume
set             group all smd/mass/density ${rho}
set             group all smd/mass/density 1
Setting atom values ...
  2601 settings made for smd/mass/density
set             group all diameter ${h} # set SPH kernel radius
set             group all diameter 0.2004 
Setting atom values ...
  2601 settings made for diameter

####################################################################################################
# DEFINE VELOCITY BOUNDARY CONDITIONS
####################################################################################################
variable        vel0 equal 0.001 # pull velocity
region          top block EDGE EDGE 0.97 EDGE EDGE EDGE units box
region          bot block EDGE EDGE EDGE -0.97 EDGE EDGE units box
group           top region top
51 atoms in group top
group           bot region bot
51 atoms in group bot
variable        vel_up equal ${vel0}  #*(1.0-exp(-0.01*time))
variable        vel_up equal 0.001  
variable        vel_down equal 0
fix             veltop_fix top smd/setvel 0 v_vel_up 0
fix             velbot_fix bot smd/setvel 0 v_vel_down 0

####################################################################################################
# INTERACTION PHYSICS / MATERIAL MODEL
####################################################################################################
pair_style      smd/tlsph
pair_coeff      1 1 *COMMON ${rho} ${E1} ${nu1} ${q1} ${q2} ${hg} ${cp}  ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      1 1 *COMMON 1 ${E1} ${nu1} ${q1} ${q2} ${hg} ${cp}  ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      1 1 *COMMON 1 1 ${nu1} ${q1} ${q2} ${hg} ${cp}  ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      1 1 *COMMON 1 1 0.35 ${q1} ${q2} ${hg} ${cp}  ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      1 1 *COMMON 1 1 0.35 0.01 ${q2} ${hg} ${cp}  ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      1 1 *COMMON 1 1 0.35 0.01 0 ${hg} ${cp}  ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      1 1 *COMMON 1 1 0.35 0.01 0 25 ${cp}  ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      1 1 *COMMON 1 1 0.35 0.01 0 25 1  ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      1 1 *COMMON 1 1 0.35 0.01 0 25 1  0                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END

pair_coeff      2 2 *COMMON ${rho} ${E2} ${nu2} ${q1} ${q2} ${hg} ${cp} ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      2 2 *COMMON 1 ${E2} ${nu2} ${q1} ${q2} ${hg} ${cp} ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      2 2 *COMMON 1 3 ${nu2} ${q1} ${q2} ${hg} ${cp} ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      2 2 *COMMON 1 3 0.3 ${q1} ${q2} ${hg} ${cp} ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      2 2 *COMMON 1 3 0.3 0.01 ${q2} ${hg} ${cp} ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      2 2 *COMMON 1 3 0.3 0.01 0 ${hg} ${cp} ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      2 2 *COMMON 1 3 0.3 0.01 0 25 ${cp} ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      2 2 *COMMON 1 3 0.3 0.01 0 25 1 ${FLAG_HYPER}                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END
pair_coeff      2 2 *COMMON 1 3 0.3 0.01 0 25 1 0                *STRENGTH_LINEAR                 *EOS_LINEAR                 *END

pair_coeff      1 2 *CROSS

####################################################################################################
# TIME INTEGRATION
####################################################################################################
fix             dtfix tlsph smd/adjust_dt 0.1 # dynamically adjust time increment every step
fix             integration_fix tlsph smd/integrate_tlsph

####################################################################################################
# SPECIFY TRAJECTORY OUTPUT
# Cauchy Stress: s11, s22, s33, s12, s13, s23
# PK1: 	P11, P12, P13, P21, P22, P23, P31, P32, P33,
####################################################################################################
compute         S all smd/tlsph/stress # Cauchy stress tensor
compute         E all smd/tlsph/strain # Green-Lagrange strain tensor
compute         nn all smd/tlsph/num/neighs # number of neighbors for each particle
dump            dump_id all custom 1000 dump.LAMMPS id type x y z vx vy vz                 c_S[1] c_S[2] c_S[4] c_nn 		c_E[1] c_E[2] c_E[4]
dump_modify     dump_id first yes

####################################################################################################
# STATUS OUTPUT
####################################################################################################
variable        stress equal 0.5*(f_velbot_fix[2]-f_veltop_fix[2])/20 # stress = force / initial width
variable        length equal xcm(top,y)-xcm(bot,y)
variable        strain equal (v_length-${length})/${length} # engineering strain
variable        strain equal (v_length-2)/${length} 
variable        strain equal (v_length-2)/2 
fix             stress_curve all print 1000 "${length} ${strain} ${stress}" file stress_strain.dat screen no

thermo          1000
thermo_style    custom step dt f_dtfix v_strain

####################################################################################################
# RUN SIMULATION
####################################################################################################
run             20000
Neighbor list info ...
  update every 10 steps, delay 0 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 0.4008
  ghost atom cutoff = 0.4008
  binsize = 0.2004, bins = 10 10 1
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair smd/tlsph, perpetual
      attributes: half, newton off, size
      pair build: half/size/bin/newtoff
      stencil: half/bin/2d/newtoff
      bin: standard

TLSPH neighbors:
  max # of neighbors for a single particle = 80
  average # of neighbors/particle in group tlsph = 73.3057
Per MPI rank memory allocation (min/avg/max) = 46.95 | 46.95 | 46.95 Mbytes
Step Dt f_dtfix v_strain 
       0        1e-16            0            0 
    1000 0.0099556918    9.9529003 0.0049764501 
    2000 0.0099371784    19.898373 0.0099491866 
    3000  0.009918919    29.826535  0.014913267 
    4000 0.0099025435    39.737814  0.019868907 
    5000 0.0098867414    49.632266  0.024816133 
    6000 0.0098702684    59.510412  0.029755206 
    7000 0.0098536576    69.372421  0.034686211 
    8000 0.0098383762    79.218701   0.03960935 
    9000 0.0098230724    89.049346  0.044524673 
   10000  0.009808119     98.86477  0.049432385 
   11000 0.0097925383    108.66516  0.054332579 
   12000 0.0097785734    118.45081  0.059225407 
   13000 0.0097638396    128.22193  0.064110966 
   14000 0.0097499445    137.97877  0.068989385 
   15000 0.0097357103    147.72161  0.073860803 
   16000 0.0097221384     157.4506    0.0787253 
   17000 0.0097088926    167.16603  0.083583015 
   18000  0.009695279    176.86808  0.088434042 
   19000 0.0096824143    186.55698  0.093278492 
   20000  0.009669604    196.23295  0.098116477 
Loop time of 368.233 on 1 procs for 20000 steps with 2601 atoms

99.9% CPU use with 1 MPI tasks x no OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 367.43     | 367.43     | 367.43     |   0.0 | 99.78
Neigh   | 0.00301    | 0.00301    | 0.00301    |   0.0 |  0.00
Comm    | 0.0025458  | 0.0025458  | 0.0025458  |   0.0 |  0.00
Output  | 0.14148    | 0.14148    | 0.14148    |   0.0 |  0.04
Modify  | 0.5903     | 0.5903     | 0.5903     |   0.0 |  0.16
Other   |            | 0.06981    |            |       |  0.02

Nlocal:        2601.00 ave        2601 max        2601 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:        0.00000 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:       333421.0 ave      333421 max      333421 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 333421
Ave neighs/atom = 128.18954
Neighbor list builds = 1
Dangerous builds = 0




Total wall time: 0:06:08
